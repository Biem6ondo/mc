print("Module: Chat is Loaded!")

local MCText = loadstring(readfile(".MCFont.lua"))()

local sg = Instance.new("ScreenGui", game.CoreGui)
sg.Name = "Message"

local f = Instance.new("ScrollingFrame", sg)
Instance.new("UIListLayout", f)

f.Size = UDim2.new(0, 500, 0.4, 0)
f.Position = UDim2.new(0, 0, 0.2, 0)
f.CanvasSize = UDim2.new(0, 0, 0, 0)
f.AutomaticCanvasSize = Enum.AutomaticSize.Y
f.ScrollBarThickness = 0
f.ScrollingEnabled = false
f.BackgroundTransparency = 1

local function fadeAndDestroy(obj)
	task.delay(10, function()
		if not obj or not obj.Frame or not obj.Frame:IsDescendantOf(f) then return end

		local totalSteps = 20
		for step = 0, totalSteps do
			task.wait(0.05)
			local alpha = step / totalSteps
			for _, v in ipairs(obj.Frame:GetDescendants()) do
				if v:IsA("ImageLabel") then
					v.ImageTransparency = alpha
				elseif v:IsA("Frame") then
					v.BackgroundTransparency = alpha
				end
			end
		end

		obj.Frame:Destroy()
	end)
end

_G.sendMessage = function(text, color)
	local msg = MCText(text, 2.7, 0.2, color or Color3.new(1, 1, 1), UDim2.new(0, 0, 0, 0), f, 500)
	task.spawn(fadeAndDestroy, msg)
	task.wait()
	f.CanvasPosition = Vector2.new(0, f.AbsoluteCanvasSize.Y)
end