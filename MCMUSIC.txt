print("Module: MCMusic Active Sound Loaded!")

local SoundService = game:GetService("SoundService")
local folder = "MCMusic"
if not isfolder(folder) then makefolder(folder) end

local musicList = {
    {
        url = "https://vgmsite.com/soundtracks/minecraft/jrevvjewku/1-03.%20Subwoofer%20Lullaby.mp3",
        name = "SubwooferLullaby.mp3"
    },
    {
        url = "https://vgmsite.com/soundtracks/minecraft/dnrkrrlpmm/1-14.%20Clark.mp3",
        name = "Clark.mp3"
    },
    {
        url = "https://vgmsite.com/soundtracks/minecraft/abtibsbmth/1-07.%20Haggstrom.mp3",
        name = "Haggstrom.mp3"
    },
{
url = "https://vgmsite.com/soundtracks/minecraft/fbluiiwvgz/2-13.%20Aria%20Math.mp3",
name = "Math.mp3"
},
{
url = "https://vgmsite.com/soundtracks/minecraft/roykrzlshq/1-13.%20Wet%20Hands.mp3",
name = "Hands.mp3"
}
}

for _, track in ipairs(musicList) do
    local filePath = folder.."/"..track.name
    if not isfile(filePath) then
        local success, data = pcall(function()
            return game:HttpGet(track.url, true)
        end)
        if success and data then
            writefile(filePath, data)
        end
    end
end

local remaining = {}
local function resetRemaining()
    remaining = {}
    for i = 1, #musicList do
        table.insert(remaining, i)
    end
end

local lastIndex = nil
local sound = Instance.new("Sound")
sound.Name = "MCMusicSound"
sound.Parent = SoundService
sound.Volume = 1
sound.Looped = false

local function playNext()
    if #remaining == 0 then
        resetRemaining()
    end
    if lastIndex and #remaining > 1 then
        for i, v in ipairs(remaining) do
            if v == lastIndex then
                table.remove(remaining, i)
                break
            end
        end
    end
    local idx = math.random(1, #remaining)
    local chosenIndex = table.remove(remaining, idx)
    lastIndex = chosenIndex
    local track = musicList[chosenIndex]
    local filePath = folder.."/"..track.name
    sound.SoundId = getcustomasset(filePath)
    sound:Play()
end

sound.Ended:Connect(function()
    playNext()
end)

resetRemaining()
playNext()